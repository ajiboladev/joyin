<!DOCTYPE html>
<!-- 
    JOYIN Social Media
    Built with passion.
    © 2025 JOYIN. All rights reserved.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=3.0, user-scalable=no">
    <title>Always Fresh Social Media | JOYIN</title>
    <link rel="stylesheet" href="./home.css">
    <link rel="icon" type="image/x-icon" href="../joyin-favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 
    
    <link rel="manifest" href="../manifest.json">
<meta name="theme-color" content="#5b53f2">
<script src="../pwa-install.js"></script>

</head>
<body id="body">
    <head>
        <h2 class="brand"><a onclick="window.location.reload()">JOYIN</a></h2>
    </head>

    <div class="search-icon" onclick="window.location.href='../searchbar/'">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5b53f2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"/>
    <path d="m21 21-4.35-4.35"/>
</svg>
    </div>
       <!-- Main -->
        <main class="desktop">
            

            <!-- Profile top tab -->
            <section class="top-profile-tab">
                <div class="profile-tab-container">
                    <div class="profile" onclick=" window.location.href= '../profile/?view=profile&permission=allowed'" style="cursor: pointer;">
                        <a  id="image"><img id="profileImage" src="https://tse1.mm.bing.net/th/id/OIP.cEvbluCvNFD_k4wC3k-_UwHaHa?rs=1&pid=ImgDetMain&o=7&rm=3" alt=""></a>
                        <p id="profile-username">no profile added yet</p>
                    </div>
                </div>
            </section>

            <!-- Side bar Navigation -->
            <section class="side-navigation">
                <div class="side-navigation-container">
                    <nav class="nav-links">
                        <a class="nav-link active" onclick="window.location.reload()"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg></span> For You</a>
                        <a  class="nav-link" onclick="window.location.href= '../profile/?view=profile&permission=allowed'"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="7" r="4"/>
                                <path d="M6 21v-2a6 6 0 0 1 12 0v2"/>
                            </svg></span> Profile</a>
                        <a  class="nav-link"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    </span> Messages</a>
                        <a  class="nav-link" id="followers-desktop"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="8" cy="8" r="3"/>
                                        <path d="M2 20v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                                        <circle cx="16" cy="8" r="3"/>
                                        <path d="M22 20v-2a4 4 0 0 0-4-4h-4a4 4 0 0 0-4 4v2"/>
                                    </svg>
                                    </span> Followers</a>
                        <a  class="nav-link" id="following-desktop"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="9" cy="8" r="3"/>
                                <path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                                <path d="M17 10l2 2 3-3"/>
                            </svg></span> Following</a>
                        <a  class="nav-link" onclick="window.location.href='../upload/?view=upload'"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M16 16l-4-4-4 4"/>
                                <path d="M12 12v9"/>
                                <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
                            </svg></span> Upload</a>
                            <a  class="nav-link" id="upload-desktop" onclick="window.location.href='../searchbar/'"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg></span>Search</a>
                        <a  class="nav-link" id="logout"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M9 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"/>
                                        <path d="M16 17l5-5-5-5"/>
                                        <path d="M21 12H9"/>
                                    </svg>
                                    </span> Logout</a>
                    </nav>
                </div>
            </section>


            <!-- Bottom Navigations -->
           <!-- Bottom Navigations -->
<section class="bottom-navbar">
    <div class="nav">
        <nav class="nav-links">
            <a class="nav-link active" onclick="window.location.reload()">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                </span>
                <span class="nav-label" style="font-size: 10px; margin-top: 4px; color: rgba(255,255,255,0.8);">Home</span>
            </a>
            <a class="nav-link" onclick="window.location.href= '../profile/?view=profile&permission=allowed'">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="7" r="4"/>
                        <path d="M6 21v-2a6 6 0 0 1 12 0v2"/>
                    </svg>
                </span>
                <span class="nav-label" style="font-size: 10px; margin-top: 4px; color: rgba(255,255,255,0.8);"></span>
            </a>
            <a class="nav-link" onclick="window.location.href='../upload/?view=upload'">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M16 16l-4-4-4 4"/>
                        <path d="M12 12v9"/>
                        <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
                    </svg>
                </span>
                <span class="nav-label" style="font-size: 10px; margin-top: 4px; color: rgba(255,255,255,0.8);"></span>
            </a>
            <a class="nav-link">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </span>
                <span class="nav-label" style="font-size: 10px; margin-top: 4px; color: rgba(255,255,255,0.8);"></span>
            </a>
            <a class="nav-link" id="followers-mobile">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="8" cy="8" r="3"/>
                        <path d="M2 20v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                        <circle cx="16" cy="8" r="3"/>
                        <path d="M22 20v-2a4 4 0 0 0-4-4h-4a4 4 0 0 0-4 4v2"/>
                    </svg>
                </span>
                <span class="nav-label" style="font-size: 10px; margin-top: 4px; color: rgba(255,255,255,0.8);"></span>
            </a>
        </nav>
    </div>
</section>

<!-- Add this right before </body> in your main page -->
<div id="floating-updates-btn">
  <button id="updates-btn">
    <span class="btn-icon"><i class="fas fa-bell"></i></span>
    <span class="btn-text">Updates</span>
    <span class="notification-dot" id="notification-dot"></span>
  </button>
</div>

<style>
  /* ===== FLOATING UPDATES BUTTON ===== */
  #floating-updates-btn {
    position: fixed;
    bottom: 30px;
    left: 30px;
    z-index: 1000;
  }
  
  #updates-btn {
    background: linear-gradient(135deg, #5b53f2 0%, #6a63f4 100%);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 14px 24px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 6px 20px rgba(91, 83, 242, 0.3);
    transition: all 0.3s ease;
  }
  
  #updates-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(91, 83, 242, 0.4);
    background: linear-gradient(135deg, #6a63f4 0%, #7a73f5 100%);
  }
  
  #updates-btn:active {
    transform: translateY(0);
  }
  
  .btn-icon {
    font-size: 20px;
  }
  
  .btn-text {
    font-size: 15px;
  }
  
  /* Notification dot */
  .notification-dot {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 14px;
    height: 14px;
    background: #ff4757;
    border-radius: 50%;
    border: 3px solid #000000;
    display: none;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }
  
  /* ===== MOBILE & TABLET ===== */
  @media (max-width: 1024px) {
    #floating-updates-btn {
      bottom: 25px;
      left: 25px;
    }
    
    #updates-btn {
      padding: 14px;
      border-radius: 50%;
      font-size: 12px;
      color: rgba(212, 208, 208, 0.769);
      width: 60px;
      height: 60px;
      justify-content: center;
    }
    
    .btn-text {
      display: none; /* Hide text on mobile/tablet */
    }
    
    .btn-icon {
      font-size: 24px;
    }
    
    .notification-dot {
      width: 18px;
      height: 18px;
      top: -8px;
      right: -8px;
      border: 3px solid #000000;
    }
  }
  
  /* ===== VERY SMALL MOBILE ===== */
  @media (max-width: 480px) {
    #floating-updates-btn {
      bottom: 75px;
      left: 80%;
    }
    
    #updates-btn {
      width: 56px;
      height: 56px;
      padding: 14px;
    }
    
    .notification-dot {
      width: 16px;
      height: 16px;
      top: -6px;
      right: -6px;
    }
  }
  
  /* ===== DESKTOP LARGE ===== */
  @media (min-width: 1025px) {
    #floating-updates-btn {
      bottom: 40px;
      left: 40px;
    }
  }
</style>

<script type="module">
  import { auth, db } from '../firebase.js';
  import { 
    doc, getDoc, updateDoc, serverTimestamp,
    collection, query, where, orderBy, limit, getDocs
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  
  // Initialize the floating button
  function initFloatingButton() {
    const btn = document.getElementById('updates-btn');
    if (btn) {
      btn.addEventListener('click', () => {
        window.location.href = '../updates/'; // Change this to your updates page path
      });
    }
  }
  
  // Check for new updates
  async function checkForNewUpdates() {
    try {
      const user = auth.currentUser;
      if (!user) return;
      
      // Get user's last seen time
      const userRef = doc(db, "users", user.uid);
      const userSnap = await getDoc(userRef);
      
      let lastSeen = new Date(0);
      if (userSnap.exists()) {
        const userData = userSnap.data();
        if (userData.lastSeenUpdates) {
          lastSeen = userData.lastSeenUpdates.toDate();
        }
      }
      
      // Get latest important update
      const updatesRef = collection(db, "updates");
      const q = query(
        updatesRef,
        where("priority", "==", "important" || "normal"),
        where("isActive", "==", true),
        orderBy("createdAt", "desc"),
        limit(1)
      );
      
      const snapshot = await getDocs(q);
      
      const dot = document.getElementById('notification-dot');
      if (!dot) return;
      
      if (!snapshot.empty) {
        const latestUpdate = snapshot.docs[0].data();
        const latestTime = latestUpdate.createdAt.toDate();
        
        if (latestTime > lastSeen) {
          // Show red dot with animation
          dot.style.display = 'block';
          dot.style.animation = 'pulse 1.5s infinite';
        } else {
          dot.style.display = 'none';
        }
      } else {
        dot.style.display = 'none';
      }
      
    } catch (error) {
      console.error("Error checking updates:", error);
    }
  }
  
  // Initialize when page loads
  document.addEventListener('DOMContentLoaded', function() {
    initFloatingButton();
    
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // Check immediately
        checkForNewUpdates();
        
        // Check every 2 minutes
        setInterval(checkForNewUpdates, 120000);
        
        // Also check when user comes back to tab
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden) {
            checkForNewUpdates();
          }
        });
      }
    });
  });
</script>


<!-- Feedback Button Container -->
<!-- <div id="feedbackWidget" class="feedback-widget hidden">
    <button id="feedbackButton" class="feedback-button">
        <svg class="feedback-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
        <span class="feedback-text">Submit Feedback</span>
    </button>
    <button id="closeFeedback" class="close-button" aria-label="Close feedback button">
        ×
    </button>
</div> -->

<!-- <script>
// Feedback Widget Manager WITHOUT LocalStorage
class FeedbackWidget {
    constructor() {
        // Configuration
        this.DELAY_MS = 7000; // 5 seconds (for testing)
        this.FORM_URL = 'https://forms.gle/7TNkUGPYogvXsqwc7';
        
        // Elements
        this.widget = document.getElementById('feedbackWidget');
        this.button = document.getElementById('feedbackButton');
        this.closeButton = document.getElementById('closeFeedback');
        
        // Initialize immediately
        this.init();
    }
    
    init() {
        // Start the timer to show widget
        setTimeout(() => this.showWidget(), this.DELAY_MS);
        
        // Setup event listeners
        this.setupEvents();
    }
    
    setupEvents() {
        // Open feedback form
        this.button.addEventListener('click', (e) => {
            e.preventDefault();
            this.handleFeedbackClick();
        });
        
        // Close widget without opening form
        this.closeButton.addEventListener('click', (e) => {
            e.stopPropagation();
            this.handleClose();
        });
    }
    
    showWidget() {
        // Remove hidden class and add visible class with a slight delay
        this.widget.classList.remove('hidden');
        
        // Trigger animation after a tiny delay
        setTimeout(() => {
            this.widget.classList.add('visible');
            
            // Optional: Auto-hide after 60 seconds
            // setTimeout(() => {
            //     if (this.widget.classList.contains('visible')) {
            //         this.handleClose();
            //     }
            // }, 60000); // 60 seconds
        }, 50);
    }
    
    handleFeedbackClick() {
        // Open form in new tab
        window.open(this.FORM_URL, '_blank', 'noopener,noreferrer');
        
        // Hide widget with animation
        this.hideWidget();
        
        console.log('Feedback widget: Form opened.');
    }
    
    handleClose() {
        // Hide widget
        this.hideWidget();
        
        console.log('Feedback widget: User dismissed.');
    }
    
    hideWidget() {
        // Remove visible class for fade-out animation
        this.widget.classList.remove('visible');
        
        // After animation completes, add hidden class
        setTimeout(() => {
            this.widget.classList.add('hidden');
        }, 500); // Match CSS transition duration
    }
}

// Initialize when DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
    new FeedbackWidget();
});
</script>

 -->



                 <!-- Post System -->

            <section class="text-image-post-system">
               <main class="main-container">
        <!-- Posts will be dynamically inserted here -->
        <div id="posts" class="posts-container">
            <!-- Posts from Firebase will appear here automatically -->
            <!-- Loading message will show temporarily -->
            <div class="loading-posts">
                <i class="fas fa-spinner fa-spin"></i> Loading posts...
            </div>
        </div>
    </main>
               
            </section>

            <style>
                /* home.css - Styles for home feed */

.posts-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    margin-top: 100px;
}

.post {
    background: var(--card-bg, #111);
    border: 1px solid var(--border-color, #333);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.post-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    cursor: pointer;
}

.post-header img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.post-username {
    font-weight: 600;
    margin: 0;
}

.post-status {
    font-size: 12px;
    color: var(--subtext-color, #888);
    margin-left: auto;
}

.post-text-content {
    margin: 15px 0;
    line-height: 1.5;
}

.post-image-container {
    display: block;
    margin: 15px 0;
}

.post-image {
    width: 100%;
    max-height: 400px;
    object-fit: contain;
    border-radius: 8px;
    cursor: pointer;
}

.reaction {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 15px 0;
    color: var(--subtext-color, #888);
}

.reaction svg {
    color: #ef4444; /* Red heart */
}

.post-actions {
    display: flex;
    gap: 10px;
    border-top: 1px solid var(--border-color, #333);
    padding-top: 15px;
}

.action-button {
    flex: 1;
    padding: 10px;
    background: none;
    border: none;
    color: var(--text-color, #fff);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: 5px;
    transition: background 0.2s;
}

.action-button:hover {
    background: rgba(255, 255, 255, 0.1);
}

.loading-posts {
    text-align: center;
    padding: 40px;
    color: var(--subtext-color, #888);
}

.no-posts {
    text-align: center;
    padding: 40px;
}

.no-posts button {
    background: var(--accent-color, #5b53f2);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
}

.error-message {
    text-align: center;
    padding: 40px;
    color: #ef4444;
}

.error-message button {
    background: #333;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
}
            </style>

            
        </main>

        
        

        <script type="module" src="./home.js"></script>
      
</body>
</html>